<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PATIKA - Plataforma Definitiva de Roteiro</title>
    <style>
        /* ===== RESET E VARI√ÅVEIS ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Cores - Design System */
            --bg-app: #f3f4f3;
            --bg-surface: #ffffff;
            --bg-sidebar: #f8f9fa;
            --border-color: #e0e0e0;
            --border-light: #e6e6e6;
            
            --text-primary: #2f2f2f;
            --text-secondary: #6b6b6b;
            --text-muted: #9a9a9a;
            
            --accent-primary: #6f8f7b;
            --accent-hover: #5f7d6b;
            --accent-light: #8fa99a;
            --accent-selection: #e8efe9;
            
            --input-border: #dcdcdc;
            
            /* Espa√ßamentos */
            --space-xs: 4px;
            --space-sm: 8px;
            --space-md: 16px;
            --space-lg: 24px;
            --space-xl: 32px;
            --space-xxl: 48px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-app);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
            line-height: 1.6;
        }

        /* ===== LAYOUT PRINCIPAL ===== */
        .app {
            display: grid;
            grid-template-columns: 250px 1fr 300px;
            grid-template-rows: auto 1fr auto;
            height: 100vh;
        }

        /* ===== TOP BAR ===== */
        .top-bar {
            grid-column: 1 / -1;
            background: var(--bg-surface);
            border-bottom: 2px solid var(--accent-primary);
            display: flex;
            align-items: center;
            padding: 0 var(--space-xl);
            box-shadow: 0 1px 3px rgba(0,0,0,0.02);
        }

        .logo-area {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-right: var(--space-xl);
        }

        .logo-icon {
            font-size: 1.8rem;
            color: var(--accent-primary);
        }

        .logo-text {
            font-weight: 600;
            color: var(--accent-primary);
            font-size: 1.2rem;
            letter-spacing: 0.5px;
        }

        .tabs-container {
            display: flex;
            height: 100%;
        }

        .tab-item {
            padding: 0 var(--space-lg);
            height: 100%;
            display: flex;
            align-items: center;
            cursor: pointer;
            color: var(--text-secondary);
            border-bottom: 3px solid transparent;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .tab-item:hover {
            color: var(--accent-primary);
            background: var(--accent-selection);
        }

        .tab-item.active {
            color: var(--accent-primary);
            border-bottom-color: var(--accent-primary);
        }

        .project-status {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: var(--space-md);
            font-size: 0.85rem;
        }

        #project-name {
            background: var(--bg-sidebar);
            padding: var(--space-xs) var(--space-md);
            border-radius: 30px;
            color: var(--text-primary);
        }

        .status-indicator {
            color: var(--accent-primary);
        }

        /* ===== SIDEBAR ESQUERDA (MENU) ===== */
        .sidebar-left {
            background: var(--bg-surface);
            border-right: 1px solid var(--border-color);
            padding: var(--space-lg) 0;
            overflow-y: auto;
        }

        .menu-section {
            margin-bottom: var(--space-xl);
        }

        .menu-title {
            padding: 0 var(--space-lg);
            margin-bottom: var(--space-md);
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .menu-item {
            padding: var(--space-sm) var(--space-lg);
            cursor: pointer;
            color: var(--text-primary);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .menu-item:hover {
            background: var(--accent-selection);
            color: var(--accent-primary);
        }

        .menu-item.active {
            background: var(--accent-primary);
            color: white;
            border-left-color: white;
        }

        /* ===== √ÅREA CENTRAL ===== */
        .main-content {
            background: var(--bg-surface);
            margin: var(--space-lg);
            padding: var(--space-xl);
            border-radius: 16px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.02);
            overflow-y: auto;
        }

        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--space-lg);
        }

        .content-header h2 {
            color: var(--accent-primary);
            font-weight: 400;
        }

        /* ===== SIDEBAR DIREITA (CONTEXTO) ===== */
        .sidebar-right {
            background: var(--bg-surface);
            border-left: 1px solid var(--border-color);
            padding: var(--space-lg);
            overflow-y: auto;
        }

        .context-section {
            background: var(--bg-sidebar);
            border-radius: 12px;
            padding: var(--space-md);
            margin-bottom: var(--space-lg);
        }

        .context-section h3 {
            color: var(--accent-primary);
            font-size: 0.9rem;
            margin-bottom: var(--space-md);
            padding-bottom: var(--space-xs);
            border-bottom: 2px solid var(--accent-primary);
        }

        /* ===== EDITOR DE ROTEIRO ===== */
        .editor-toolbar {
            display: flex;
            gap: var(--space-xs);
            flex-wrap: wrap;
            margin-bottom: var(--space-lg);
            padding: var(--space-sm);
            background: var(--bg-sidebar);
            border-radius: 10px;
        }

        .btn {
            padding: var(--space-xs) var(--space-md);
            border: 1px solid var(--border-light);
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.15s;
            color: var(--text-primary);
        }

        .btn:hover {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .btn-accent {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .btn-accent:hover {
            background: var(--accent-hover);
        }

        .roteiro-editor {
            font-family: 'Courier New', 'IBM Plex Mono', monospace;
            line-height: 1.8;
            min-height: 500px;
            padding: var(--space-xl);
            background: var(--bg-sidebar);
            border: 2px dashed var(--border-light);
            border-radius: 12px;
            outline: none;
            font-size: 14px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .roteiro-editor:focus {
            border-color: var(--accent-primary);
            background: white;
        }

        /* Estilos de formata√ß√£o do roteiro */
        .patika-cena {
            font-weight: bold;
            text-transform: uppercase;
            margin-top: var(--space-lg);
            color: var(--accent-primary);
        }

        .patika-personagem {
            margin-left: 200px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .patika-dialogo {
            margin-left: 140px;
            margin-right: 140px;
        }

        .patika-transicao {
            text-transform: uppercase;
            color: var(--text-secondary);
            margin-top: var(--space-sm);
            font-style: italic;
        }

        .patika-parentese {
            margin-left: 200px;
            font-style: italic;
            color: var(--text-secondary);
        }

        .patika-acao {
            margin-left: 0;
        }

        /* ===== LISTA DE CENAS ===== */
        .cena-item {
            padding: var(--space-sm);
            background: white;
            border-radius: 6px;
            margin-bottom: var(--space-xs);
            cursor: pointer;
            font-size: 0.8rem;
            border-left: 3px solid var(--accent-primary);
            transition: all 0.15s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.02);
        }

        .cena-item:hover {
            background: var(--accent-primary);
            color: white;
            transform: translateX(4px);
        }

        /* ===== √ÅREA DE TEXTO SIMPLES (OUTRAS ABAS) ===== */
        .simple-textarea {
            width: 100%;
            min-height: 500px;
            padding: var(--space-lg);
            border: 1px solid var(--border-light);
            border-radius: 12px;
            font-size: 1rem;
            line-height: 1.7;
            resize: vertical;
            background: var(--bg-sidebar);
        }

        .simple-textarea:focus {
            outline: 2px solid var(--accent-light);
            border-color: transparent;
        }

        /* ===== FORMUL√ÅRIO DINDO ===== */
        .dindo-form {
            background: linear-gradient(145deg, var(--bg-sidebar), white);
            padding: var(--space-xl);
            border-radius: 16px;
            border: 1px solid var(--border-light);
        }

        .form-group {
            margin-bottom: var(--space-lg);
        }

        .form-group label {
            display: block;
            margin-bottom: var(--space-xs);
            font-weight: 500;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            border: 1px solid var(--input-border);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.15s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-selection);
        }

        .contrato-preview {
            background: var(--bg-sidebar);
            padding: var(--space-lg);
            border-radius: 12px;
            border-left: 5px solid var(--accent-primary);
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            margin-top: var(--space-lg);
            font-size: 0.9rem;
        }

        /* ===== STATUS BAR (FOOTER) ===== */
        .status-bar {
            grid-column: 1 / -1;
            background: var(--bg-surface);
            border-top: 1px solid var(--border-color);
            padding: var(--space-sm) var(--space-xl);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .word-count {
            color: var(--accent-primary);
            font-weight: 600;
        }

        /* ===== SCROLLBAR PERSONALIZADA ===== */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--bg-app);
        }
        ::-webkit-scrollbar-thumb {
            background: #c0c0c0;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-primary);
        }

        /* ===== UTILIT√ÅRIOS ===== */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .mt-2 { margin-top: var(--space-md); }
        .w-100 { width: 100%; }
    </style>
</head>
<body>
    <div class="app" id="app">
        <!-- TOP BAR -->
        <header class="top-bar">
            <div class="logo-area">
                <span class="logo-icon">üé¨</span>
                <span class="logo-text">PATIKA</span>
            </div>
            <nav class="tabs-container" id="mainTabs">
                <div class="tab-item active" data-tab="roteiro">üìù ROTEIRO</div>
                <div class="tab-item" data-tab="dindo">üìÑ DINDO</div>
                <div class="tab-item" data-tab="sinopse">üìã SINOPSE</div>
                <div class="tab-item" data-tab="argumento">üìÑ ARGUMENTO</div>
                <div class="tab-item" data-tab="escaleta">üìä ESCALETA</div>
                <div class="tab-item" data-tab="personagens">üë• PERSONAGENS</div>
            </nav>
            <div class="project-status">
                <span id="project-name">projeto_sem_t√≠tulo</span>
                <span class="status-indicator" id="statusIndicator">‚óè pronto</span>
            </div>
        </header>

        <!-- SIDEBAR ESQUERDA (MENU) -->
        <aside class="sidebar-left" id="sidebarLeft">
            <div class="menu-section">
                <div class="menu-title">FERRAMENTAS</div>
                <div class="menu-item active" data-tool="roteiro-editor">üìù Editor</div>
                <div class="menu-item" data-tool="timeline">üìä Timeline</div>
                <div class="menu-item" data-tool="versoes">üîÑ Vers√µes</div>
            </div>
            <div class="menu-section">
                <div class="menu-title">MODOS</div>
                <div class="menu-item" data-tool="foco">üéØ Modo Foco</div>
                <div class="menu-item" data-tool="escuro">üåô Tema Escuro</div>
                <div class="menu-item" data-tool="typewriter">üì† Typewriter</div>
            </div>
            <div class="menu-section">
                <div class="menu-title">DADOS</div>
                <div class="menu-item" data-tool="exportar">üì§ Exportar</div>
                <div class="menu-item" data-tool="importar">üì• Importar</div>
                <div class="menu-item" data-tool="backup">üíæ Backup</div>
            </div>
        </aside>

        <!-- √ÅREA CENTRAL PRINCIPAL -->
        <main class="main-content" id="mainContent">
            <!-- O conte√∫do ser√° injetado via JavaScript -->
        </main>

        <!-- SIDEBAR DIREITA (CONTEXTO) -->
        <aside class="sidebar-right" id="sidebarRight">
            <!-- O conte√∫do ser√° injetado via JavaScript -->
        </aside>

        <!-- STATUS BAR (FOOTER) -->
        <footer class="status-bar">
            <span>¬© PATIKA - Plataforma Definitiva</span>
            <span class="word-count" id="globalWordCount">0 palavras</span>
            <span id="autoSaveIndicator">Auto-save ativo</span>
        </footer>
    </div>

    <script>
        (function() {
            "use strict";

            // ============================================
            // ESTADO GLOBAL E CONFIGURA√á√ïES
            // ============================================
            const State = {
                currentTab: 'roteiro',
                currentTool: 'roteiro-editor',
                versoes: JSON.parse(localStorage.getItem('patika_versoes') || '[]'),
                personagens: JSON.parse(localStorage.getItem('patika_personagens') || '[]'),
                notas: JSON.parse(localStorage.getItem('patika_notas') || '{}'),
                ultimoContrato: localStorage.getItem('patika_ultimo_contrato') || '',
                config: {
                    darkMode: localStorage.getItem('patika_dark_mode') === 'true',
                    typewriterMode: false,
                }
            };

            // ============================================
            // FUN√á√ïES AUXILIARES
            // ============================================
            function updateWordCount(element) {
                if (!element) return 0;
                const text = element.innerText || element.value || '';
                return text.trim().split(/\s+/).filter(Boolean).length;
            }

            function saveToStorage(key, value) {
                localStorage.setItem(`patika_${key}`, JSON.stringify(value));
            }

            function loadFromStorage(key, defaultValue = null) {
                const item = localStorage.getItem(`patika_${key}`);
                return item ? JSON.parse(item) : defaultValue;
            }

            // ============================================
            // M√ìDULO ROTEIRO (N√∫cleo Final Draft)
            // ============================================
            const RoteiroModule = {
                editorElement: null,

                init() {
                    this.render();
                    this.attachEvents();
                    this.loadContent();
                },

                render() {
                    const main = document.getElementById('mainContent');
                    main.innerHTML = `
                        <div class="content-header">
                            <h2>üé¨ Editor de Roteiro Profissional</h2>
                            <div>
                                <button class="btn" id="btnSalvarVersao">üíæ Salvar Vers√£o</button>
                                <button class="btn" id="btnExportarRoteiro">üì§ Exportar TXT</button>
                            </div>
                        </div>
                        <div class="editor-toolbar">
                            <button class="btn" data-inserir="cena">üé¨ Cena</button>
                            <button class="btn" data-inserir="personagem">üë§ Personagem</button>
                            <button class="btn" data-inserir="dialogo">üí¨ Di√°logo</button>
                            <button class="btn" data-inserir="acao">üìù A√ß√£o</button>
                            <button class="btn" data-inserir="transicao">‚è© Transi√ß√£o</button>
                            <button class="btn" data-inserir="parentese">üìù Par√™ntese</button>
                        </div>
                        <div id="roteiro-editor" class="roteiro-editor" contenteditable="true">
                            <div class="patika-cena">1. INT. PATIKA DEFINITIVO - DIA</div>
                            <div class="patika-acao">Todas as 44 vers√µes unificadas em um c√≥digo robusto.</div>
                            <div class="patika-personagem">PATIKA</div>
                            <div class="patika-dialogo">Finalmente! Todas as funcionalidades integradas.</div>
                            <div class="patika-personagem">USU√ÅRIO</div>
                            <div class="patika-dialogo">Como fa√ßo para navegar pelas cenas?</div>
                            <div class="patika-transicao">CORTE PARA:</div>
                            <div class="patika-cena">2. EXT. PARQUE - DIA</div>
                            <div class="patika-acao">Clique nas cenas √† direita para navegar.</div>
                        </div>
                    `;
                    this.editorElement = document.getElementById('roteiro-editor');
                    this.updateSidebar();
                },

                attachEvents() {
                    if (!this.editorElement) return;

                    // Inserir elementos via bot√µes
                    document.querySelectorAll('[data-inserir]').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            e.preventDefault();
                            const tipo = e.target.dataset.inserir;
                            this.inserirElemento(tipo);
                        });
                    });

                    // Teclado: Enter com auto-formata√ß√£o
                    this.editorElement.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            document.execCommand('insertLineBreak');
                            
                            setTimeout(() => {
                                const selection = window.getSelection();
                                const node = selection.anchorNode;
                                if (!node) return;
                                
                                const linha = node.parentElement;
                                if (!linha || linha === this.editorElement) return;
                                
                                const texto = linha.innerText.trim();
                                this.aplicarFormatacao(linha, texto);
                                
                                if (this.detectarTipo(texto) === 'personagem') {
                                    setTimeout(() => {
                                        const dialogo = document.createElement('div');
                                        dialogo.className = 'patika-dialogo';
                                        dialogo.innerHTML = '<br>';
                                        linha.parentNode.insertBefore(dialogo, linha.nextSibling);
                                        this.colocarCursor(dialogo);
                                    }, 10);
                                }
                                
                                this.updateSidebar();
                                this.atualizarContadorGlobal();
                            }, 10);
                        }
                    });

                    // Input: atualizar estat√≠sticas
                    this.editorElement.addEventListener('input', () => {
                        this.updateSidebar();
                        this.atualizarContadorGlobal();
                    });

                    // Bot√µes de a√ß√£o
                    document.getElementById('btnSalvarVersao')?.addEventListener('click', () => this.salvarVersao());
                    document.getElementById('btnExportarRoteiro')?.addEventListener('click', () => this.exportarTXT());
                },

                detectarTipo(texto) {
                    texto = texto.trim();
                    if (/^(INT\.|EXT\.|INT\/EXT\.)/i.test(texto)) return 'cena';
                    if (texto.length > 0 && texto === texto.toUpperCase() && texto.length < 30) return 'personagem';
                    if (/^(FADE IN|FADE OUT|CORTE PARA|DISSOLVE)/i.test(texto)) return 'transicao';
                    if (texto.startsWith('(') && texto.endsWith(')')) return 'parentese';
                    return 'acao';
                },

                aplicarFormatacao(linha, texto) {
                    const tipo = this.detectarTipo(texto);
                    linha.classList.remove('patika-cena', 'patika-personagem', 'patika-dialogo', 'patika-transicao', 'patika-parentese', 'patika-acao');
                    
                    switch(tipo) {
                        case 'cena': linha.classList.add('patika-cena'); break;
                        case 'personagem': linha.classList.add('patika-personagem'); break;
                        case 'dialogo': linha.classList.add('patika-dialogo'); break;
                        case 'transicao': linha.classList.add('patika-transicao'); break;
                        case 'parentese': linha.classList.add('patika-parentese'); break;
                        default: linha.classList.add('patika-acao');
                    }
                },

                inserirElemento(tipo) {
                    if (!this.editorElement) return;
                    
                    const linha = document.createElement('div');
                    const textos = {
                        cena: { class: 'patika-cena', text: 'INT. LOCAL - DIA' },
                        personagem: { class: 'patika-personagem', text: 'PERSONAGEM' },
                        dialogo: { class: 'patika-dialogo', text: 'Digite o di√°logo...' },
                        transicao: { class: 'patika-transicao', text: 'CORTE PARA:' },
                        parentese: { class: 'patika-parentese', text: '(express√£o)' },
                        acao: { class: 'patika-acao', text: 'A√ß√£o...' }
                    };
                    
                    const el = textos[tipo] || textos.acao;
                    linha.className = el.class;
                    linha.innerText = el.text;
                    this.editorElement.appendChild(linha);
                    this.colocarCursor(linha);
                    this.updateSidebar();
                },

                colocarCursor(elemento) {
                    const range = document.createRange();
                    const sel = window.getSelection();
                    range.selectNodeContents(elemento);
                    range.collapse(false);
                    sel.removeAllRanges();
                    sel.addRange(range);
                    elemento.focus();
                },

                updateSidebar() {
                    if (!this.editorElement) return;
                    
                    const sidebar = document.getElementById('sidebarRight');
                    const texto = this.editorElement.innerText;
                    const palavras = updateWordCount(this.editorElement);
                    
                    let cenas = [], numCena = 1;
                    for (let linha of this.editorElement.children) {
                        if (linha.classList.contains('patika-cena')) {
                            cenas.push({ index: numCena, texto: linha.innerText, element: linha });
                            numCena++;
                        }
                    }

                    let personagensSet = new Set();
                    for (let linha of this.editorElement.children) {
                        if (linha.classList.contains('patika-personagem')) {
                            personagensSet.add(linha.innerText.trim());
                        }
                    }

                    sidebar.innerHTML = `
                        <div class="context-section">
                            <h3>üìã CENAS (${cenas.length})</h3>
                            <div id="listaCenasSidebar">
                                ${cenas.map(c => `<div class="cena-item" data-index="${c.index - 1}">${c.index}. ${c.texto.substring(0, 40)}...</div>`).join('') || '<p style="color: var(--text-muted);">Nenhuma cena</p>'}
                            </div>
                        </div>
                        <div class="context-section">
                            <h3>üìä ESTAT√çSTICAS</h3>
                            <p><strong>Palavras:</strong> ${palavras}</p>
                            <p><strong>P√°ginas (estimado):</strong> ${Math.ceil(palavras / 250)}</p>
                            <p><strong>Personagens √∫nicos:</strong> ${personagensSet.size}</p>
                            <p><strong>Vers√µes salvas:</strong> ${State.versoes.length}</p>
                        </div>
                        <div class="context-section">
                            <h3>üìù NOTAS R√ÅPIDAS</h3>
                            <textarea id="quickNotes" class="form-control" rows="4" placeholder="Suas anota√ß√µes...">${State.notas[State.currentTab] || ''}</textarea>
                        </div>
                    `;

                    // Adicionar evento de clique nas cenas
                    document.querySelectorAll('#listaCenasSidebar .cena-item').forEach((item, idx) => {
                        item.addEventListener('click', () => {
                            const cenasArray = Array.from(this.editorElement.children).filter(c => c.classList.contains('patika-cena'));
                            if (cenasArray[idx]) {
                                cenasArray[idx].scrollIntoView({ behavior: 'smooth' });
                            }
                        });
                    });

                    // Evento para salvar notas
                    document.getElementById('quickNotes')?.addEventListener('input', (e) => {
                        State.notas[State.currentTab] = e.target.value;
                        saveToStorage('notas', State.notas);
                    });
                },

                salvarVersao() {
                    const conteudo = this.editorElement?.innerHTML;
                    if (!conteudo) return;
                    
                    State.versoes.unshift({
                        data: new Date().toLocaleString(),
                        conteudo: conteudo,
                        palavras: updateWordCount(this.editorElement)
                    });
                    
                    if (State.versoes.length > 15) State.versoes.pop();
                    saveToStorage('versoes', State.versoes);
                    
                    document.getElementById('statusIndicator').innerText = '‚úì salvo';
                    setTimeout(() => document.getElementById('statusIndicator').innerText = '‚óè pronto', 1500);
                    this.updateSidebar();
                },

                exportarTXT() {
                    if (!this.editorElement) return;
                    const texto = this.editorElement.innerText;
                    const blob = new Blob([texto], { type: 'text/plain' });
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(blob);
                    a.download = `roteiro_${new Date().toISOString().slice(0,10)}.txt`;
                    a.click();
                },

                loadContent() {
                    const autosave = localStorage.getItem('patika_autosave');
                    if (autosave && confirm('Restaurar √∫ltima sess√£o autom√°tica?')) {
                        this.editorElement.innerHTML = autosave;
                        this.updateSidebar();
                    }
                }
            };

            // ============================================
            // M√ìDULO DINDO (Contratos)
            // ============================================
            const DindoModule = {
                init() {
                    this.render();
                },

                render() {
                    const main = document.getElementById('mainContent');
                    main.innerHTML = `
                        <div class="content-header">
                            <h2>üìÑ DINDO - Sistema de Contratos</h2>
                        </div>
                        <div class="dindo-form">
                            <div class="form-group">
                                <label for="dindoNome">üë§ Nome do Talento:</label>
                                <input type="text" class="form-control" id="dindoNome" placeholder="Ex: Patrick Sonata">
                            </div>
                            <div class="form-group">
                                <label for="dindoBairro">üìç Bairro:</label>
                                <input type="text" class="form-control" id="dindoBairro" placeholder="Ex: Cidade de Deus">
                            </div>
                            <div class="form-group">
                                <label for="dindoFuncao">üé≠ Fun√ß√£o:</label>
                                <select class="form-control" id="dindoFuncao">
                                    <option value="Ator">Ator/Atriz</option>
                                    <option value="Diretor">Diretor</option>
                                    <option value="Roteirista">Roteirista</option>
                                    <option value="Produtor">Produtor</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="dindoProjeto">üé¨ Projeto:</label>
                                <input type="text" class="form-control" id="dindoProjeto" placeholder="Ex: Estelionato Carioca">
                            </div>
                            <button class="btn btn-accent w-100" id="btnGerarContrato">üìÑ GERAR CONTRATO</button>
                            
                            <div id="dindoPreview" class="contrato-preview ${State.ultimoContrato ? '' : 'hidden'}">
                                <pre id="contratoTexto">${State.ultimoContrato || ''}</pre>
                                <div style="display: flex; gap: 10px; margin-top: 15px;">
                                    <button class="btn" id="btnBaixarContrato">üíæ Baixar</button>
                                    <button class="btn" id="btnCopiarContrato">üìã Copiar</button>
                                </div>
                            </div>
                        </div>
                    `;

                    document.getElementById('btnGerarContrato')?.addEventListener('click', () => this.gerarContrato());
                    document.getElementById('btnBaixarContrato')?.addEventListener('click', () => this.baixarContrato());
                    document.getElementById('btnCopiarContrato')?.addEventListener('click', () => this.copiarContrato());

                    this.updateSidebar();
                },

                gerarContrato() {
                    const nome = document.getElementById('dindoNome')?.value || 'N√ÉO INFORMADO';
                    const bairro = document.getElementById('dindoBairro')?.value || 'N√ÉO INFORMADO';
                    const funcao = document.getElementById('dindoFuncao')?.value || 'Ator';
                    const projeto = document.getElementById('dindoProjeto')?.value || 'N√ÉO INFORMADO';
                    const data = new Date().toLocaleDateString('pt-BR');

                    const contrato = `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë         CONTRATO DE PRESTA√á√ÉO DE SERVI√áOS            ‚ïë
‚ïë                     TVC STUDIOS                      ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                      ‚ïë
‚ïë  CONTRATADO(A): ${nome.padEnd(40)}  ‚ïë
‚ïë  FUN√á√ÉO: ${funcao.padEnd(46)}  ‚ïë
‚ïë  BAIRRO: ${bairro.padEnd(45)}  ‚ïë
‚ïë  PROJETO: ${projeto.padEnd(43)}  ‚ïë
‚ïë                                                      ‚ïë
‚ïë  DATA DE EMISS√ÉO: ${data.padEnd(37)}  ‚ïë
‚ïë                                                      ‚ïë
‚ïë  Assinatura Dire√ß√£o TVC: __________________________ ‚ïë
‚ïë  Assinatura Contratado: ___________________________ ‚ïë
‚ïë                                                      ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë         CONTRATO DE CESS√ÉO DE IMAGEM E VOZ           ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë                                                      ‚ïë
‚ïë  CEDENTE: ${nome.padEnd(45)}  ‚ïë
‚ïë  PROJETO: ${projeto.padEnd(43)}  ‚ïë
‚ïë                                                      ‚ïë
‚ïë  DATA: ${data.padEnd(43)}  ‚ïë
‚ïë                                                      ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
`;

                    State.ultimoContrato = contrato;
                    localStorage.setItem('patika_ultimo_contrato', contrato);

                    const preview = document.getElementById('dindoPreview');
                    const textoEl = document.getElementById('contratoTexto');
                    if (preview && textoEl) {
                        preview.classList.remove('hidden');
                        textoEl.innerText = contrato;
                    }
                },

                baixarContrato() {
                    if (!State.ultimoContrato) { alert('Gere um contrato primeiro!'); return; }
                    const blob = new Blob([State.ultimoContrato], { type: 'text/plain' });
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(blob);
                    a.download = `contrato_${Date.now()}.txt`;
                    a.click();
                },

                copiarContrato() {
                    if (!State.ultimoContrato) { alert('Gere um contrato primeiro!'); return; }
                    navigator.clipboard.writeText(State.ultimoContrato).then(() => alert('‚úÖ Contrato copiado!'));
                },

                updateSidebar() {
                    const sidebar = document.getElementById('sidebarRight');
                    sidebar.innerHTML = `
                        <div class="context-section">
                            <h3>üìã SOBRE O DINDO</h3>
                            <p style="font-size: 0.9rem;">Sistema de gera√ß√£o de contratos baseado nos scripts originais encontrados no sistema (TVC_SOFTWARE).</p>
                        </div>
                        <div class="context-section">
                            <h3>‚ö° A√á√ïES R√ÅPIDAS</h3>
                            <button class="btn w-100" id="sidebarBaixar">üíæ Baixar √öltimo</button>
                            <button class="btn w-100 mt-2" id="sidebarCopiar">üìã Copiar</button>
                        </div>
                    `;
                    document.getElementById('sidebarBaixar')?.addEventListener('click', () => this.baixarContrato());
                    document.getElementById('sidebarCopiar')?.addEventListener('click', () => this.copiarContrato());
                }
            };

            // ============================================
            // M√ìDULO DE TEXTO SIMPLES (Sinopse, Argumento, etc)
            // ============================================
            const SimpleTextModule = {
                currentTab: '',
                content: {},

                init(tabName) {
                    this.currentTab = tabName;
                    this.content = State.notas[tabName] || '';
                    this.render();
                },

                render() {
                    const main = document.getElementById('mainContent');
                    const titulo = this.currentTab.toUpperCase();
                    main.innerHTML = `
                        <div class="content-header">
                            <h2>${titulo}</h2>
                            <button class="btn" id="btnSalvarTexto">üíæ Salvar</button>
                        </div>
                        <textarea id="simpleTextArea" class="simple-textarea" placeholder="Escreva seu ${this.currentTab} aqui...">${this.content}</textarea>
                    `;

                    document.getElementById('btnSalvarTexto')?.addEventListener('click', () => this.salvar());

                    const sidebar = document.getElementById('sidebarRight');
                    sidebar.innerHTML = `
                        <div class="context-section">
                            <h3>üìã ${titulo}</h3>
                            <p>Use este espa√ßo para anota√ß√µes e desenvolvimento do seu ${this.currentTab}.</p>
                            <p style="color: var(--text-muted);">As altera√ß√µes s√£o salvas automaticamente.</p>
                        </div>
                    `;

                    document.getElementById('simpleTextArea')?.addEventListener('input', (e) => {
                        this.content = e.target.value;
                        State.notas[this.currentTab] = this.content;
                        saveToStorage('notas', State.notas);
                    });
                },

                salvar() {
                    alert(`‚úÖ ${this.currentTab} salvo localmente!`);
                }
            };

            // ============================================
            // GERENCIADOR DE ABAS E MENU
            // ============================================
            function switchTab(tabId) {
                State.currentTab = tabId;

                // Atualizar abas do topo
                document.querySelectorAll('.tab-item').forEach(tab => {
                    tab.classList.toggle('active', tab.dataset.tab === tabId);
                });

                // Carregar m√≥dulo correspondente
                switch(tabId) {
                    case 'roteiro':
                        RoteiroModule.init();
                        break;
                    case 'dindo':
                        DindoModule.init();
                        break;
                    case 'sinopse':
                    case 'argumento':
                    case 'escaleta':
                    case 'personagens':
                        SimpleTextModule.init(tabId);
                        break;
                    default:
                        console.warn('Aba desconhecida:', tabId);
                }
            }

            // ============================================
            // GERENCIADOR DE FERRAMENTAS DO MENU LATERAL
            // ============================================
            function setupMenuEvents() {
                document.querySelectorAll('.menu-item[data-tool]').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const tool = item.dataset.tool;

                        // Remover active de todos e marcar o atual
                        document.querySelectorAll('.menu-item').forEach(mi => mi.classList.remove('active'));
                        item.classList.add('active');

                        // Executar a√ß√£o baseada na ferramenta
                        switch(tool) {
                            case 'roteiro-editor':
                                switchTab('roteiro');
                                break;
                            case 'timeline':
                                if (State.currentTab === 'roteiro') {
                                    const cenas = Array.from(RoteiroModule.editorElement?.children || []).filter(c => c.classList.contains('patika-cena'));
                                    let msg = 'üìä TIMELINE DE CENAS:\n\n';
                                    cenas.forEach((c, i) => msg += `${i+1}. ${c.innerText}\n`);
                                    alert(msg || 'Nenhuma cena encontrada.');
                                } else {
                                    alert('A timeline s√≥ est√° dispon√≠vel na aba Roteiro.');
                                }
                                break;
                            case 'versoes':
                                if (State.versoes.length === 0) {
                                    alert('Nenhuma vers√£o salva.');
                                } else {
                                    let msg = 'üìö VERS√ïES SALVAS:\n\n';
                                    State.versoes.slice(0, 10).forEach((v, i) => msg += `${i+1}. ${v.data} (${v.palavras || '?'} palavras)\n`);
                                    alert(msg);
                                }
                                break;
                            case 'foco':
                                document.querySelector('.sidebar-left').style.display = 'none';
                                document.querySelector('.sidebar-right').style.display = 'none';
                                setTimeout(() => {
                                    document.querySelector('.sidebar-left').style.display = 'block';
                                    document.querySelector('.sidebar-right').style.display = 'block';
                                }, 5000);
                                break;
                            case 'escuro':
                                document.body.classList.toggle('dark-mode');
                                // Implementar tema escuro simples
                                break;
                            case 'typewriter':
                                const editor = document.getElementById('roteiro-editor');
                                if (editor) {
                                    editor.style.background = editor.style.background === 'rgb(0, 0, 0)' ? '' : '#000';
                                    editor.style.color = editor.style.color === 'rgb(0, 255, 0)' ? '' : '#0f0';
                                }
                                break;
                            case 'exportar':
                                if (State.currentTab === 'roteiro') {
                                    RoteiroModule.exportarTXT();
                                } else {
                                    const area = document.getElementById('simpleTextArea');
                                    if (area) {
                                        const blob = new Blob([area.value], { type: 'text/plain' });
                                        const a = document.createElement('a');
                                        a.href = URL.createObjectURL(blob);
                                        a.download = `${State.currentTab}_${Date.now()}.txt`;
                                        a.click();
                                    }
                                }
                                break;
                            case 'importar':
                                alert('Funcionalidade de importa√ß√£o em desenvolvimento.');
                                break;
                            case 'backup':
                                const backup = {
                                    versoes: State.versoes,
                                    notas: State.notas,
                                    ultimoContrato: State.ultimoContrato,
                                    data: new Date().toISOString()
                                };
                                const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
                                const a = document.createElement('a');
                                a.href = URL.createObjectURL(blob);
                                a.download = `patika_backup_${Date.now()}.json`;
                                a.click();
                                break;
                        }
                    });
                });
            }

            // ============================================
            // AUTO-SAVE GLOBAL
            // ============================================
            function setupAutoSave() {
                setInterval(() => {
                    const editor = document.getElementById('roteiro-editor');
                    if (editor) {
                        localStorage.setItem('patika_autosave', editor.innerHTML);
                    }
                    
                    const simpleArea = document.getElementById('simpleTextArea');
                    if (simpleArea && State.currentTab !== 'roteiro' && State.currentTab !== 'dindo') {
                        State.notas[State.currentTab] = simpleArea.value;
                        saveToStorage('notas', State.notas);
                    }
                    
                    document.getElementById('autoSaveIndicator').innerText = 'üíæ salvando...';
                    setTimeout(() => document.getElementById('autoSaveIndicator').innerText = 'Auto-save ativo', 1000);
                }, 30000);
            }

            // ============================================
            // ATUALIZAR CONTADOR GLOBAL
            // ============================================
            function updateGlobalCounter() {
                const editor = document.getElementById('roteiro-editor');
                if (editor) {
                    const palavras = updateWordCount(editor);
                    document.getElementById('globalWordCount').innerText = `${palavras} palavras`;
                }
            }
            window.atualizarContadorGlobal = updateGlobalCounter;

            // ============================================
            // INICIALIZA√á√ÉO
            // ============================================
            document.addEventListener('DOMContentLoaded', () => {
                // Configurar troca de abas no topo
                document.querySelectorAll('.tab-item').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        e.preventDefault();
                        switchTab(tab.dataset.tab);
                    });
                });

                // Configurar menu lateral
                setupMenuEvents();

                // Iniciar com a aba Roteiro
                switchTab('roteiro');

                // Auto-save
                setupAutoSave();

                // Aplicar tema escuro se estava ativo
                if (State.config.darkMode) {
                    document.body.classList.add('dark-mode');
                }

                console.log('üöÄ PATIKA Definitivo iniciado com sucesso!');
            });

        })();
    </script>
</body>
</html>

<!-- ===== NOVAS FUNCIONALIDADES PATIKA (SEGURO) ===== -->
<style>
/* ===== NOVOS ESTILOS (APENAS ADICIONAIS) ===== */

/* Feedback visual para bot√µes (sem quebrar existente) */
.btn:active {
    transform: scale(0.97);
    transition: transform 0.1s;
}

/* Dica flutuante */
.patika-tooltip {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--accent-primary);
    color: white;
    padding: 10px 20px;
    border-radius: 30px;
    font-size: 14px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    z-index: 9999;
    animation: slideIn 0.3s ease-out;
    max-width: 300px;
    pointer-events: none;
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Indicador de salvamento (sem modificar existente) */
.saving-indicator {
    animation: pulse 1s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
}

/* Scrollbar personalizada (apenas melhoria visual) */
.roteiro-editor::-webkit-scrollbar {
    width: 8px;
}

.roteiro-editor::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

.roteiro-editor::-webkit-scrollbar-thumb {
    background: var(--accent-light, #8fa99a);
    border-radius: 4px;
}

.roteiro-editor::-webkit-scrollbar-thumb:hover {
    background: var(--accent-primary, #6f8f7b);
}

/* Modo foco aprimorado (usa classe existente) */
.modo-foco .sidebar-left,
.modo-foco .sidebar-right {
    display: none;
}

.modo-foco .main-content {
    max-width: 800px;
    margin: 0 auto;
}
</style>

<!-- ===== NOVAS FUNCIONALIDADES JAVASCRIPT (SEGURO) ===== -->
<script>
(function() {
    'use strict';

    // ===== 1. ATALHO CTRL+S PARA SALVAR =====
    document.addEventListener('keydown', function(e) {
        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
            e.preventDefault();
            
            // Tentar chamar fun√ß√£o de salvar existente
            if (typeof window.salvarVersao === 'function') {
                window.salvarVersao();
                mostrarNotificacao('‚úÖ Vers√£o salva!');
            } else if (typeof window.patikaSalvarVersao === 'function') {
                window.patikaSalvarVersao();
                mostrarNotificacao('‚úÖ Vers√£o salva!');
            }
        }
    });

    // ===== 2. FUN√á√ÉO DE NOTIFICA√á√ÉO (NOVA) =====
    function mostrarNotificacao(mensagem) {
        const notificacao = document.createElement('div');
        notificacao.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--accent-primary, #00A86B);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 10000;
            font-size: 14px;
            animation: slideIn 0.3s ease-out;
        `;
        notificacao.textContent = mensagem;
        document.body.appendChild(notificacao);
        
        setTimeout(() => {
            notificacao.style.opacity = '0';
            setTimeout(() => notificacao.remove(), 300);
        }, 2000);
    }

    // ===== 3. DICAS R√ÅPIDAS A CADA 2 MINUTOS =====
    const dicas = [
        'üí° Use INT. para cenas internas',
        'üí° Use EXT. para cenas externas',
        'üí° Digite nomes em CAIXA ALTA para criar personagens',
        'üí° Pressione Ctrl+S para salvar',
        'üí° Clique nas cenas √† direita para navegar',
        'üí° Use o modo foco para escrever sem distra√ß√µes'
    ];
    
    let dicaIndex = 0;
    setInterval(() => {
        const dica = document.createElement('div');
        dica.className = 'patika-tooltip';
        dica.textContent = dicas[dicaIndex % dicas.length];
        document.body.appendChild(dica);
        
        setTimeout(() => dica.remove(), 4000);
        dicaIndex++;
    }, 120000); // 2 minutos

    // ===== 4. EXPORTAR PDF (NOVA FUN√á√ÉO) =====
    window.exportarPDF = function() {
        const editor = document.getElementById('roteiro-editor');
        if (!editor) return;
        
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <html>
            <head>
                <title>Roteiro - ${new Date().toLocaleDateString()}</title>
                <style>
                    body { font-family: 'Courier New', monospace; line-height: 1.6; padding: 40px; max-width: 800px; margin: 0 auto; }
                    .patika-cena { font-weight: bold; text-transform: uppercase; margin-top: 24px; color: #00A86B; }
                    .patika-personagem { margin-left: 200px; font-weight: bold; }
                    .patika-dialogo { margin-left: 140px; margin-right: 140px; }
                    @media print { body { padding: 0; } }
                </style>
            </head>
            <body>
                <h1 style="text-align:center;">ROTEIRO</h1>
                ${editor.innerHTML}
            </body>
            </html>
        `);
        printWindow.document.close();
        printWindow.focus();
        printWindow.print();
        mostrarNotificacao('üìÑ PDF gerado!');
    };

    // ===== 5. ESTAT√çSTICAS AVAN√áADAS (NOVA FUN√á√ÉO) =====
    window.estatisticasAvancadas = function() {
        const editor = document.getElementById('roteiro-editor');
        if (!editor) return;
        
        const texto = editor.innerText;
        const palavras = texto.trim().split(/\s+/).filter(Boolean).length;
        const caracteres = texto.length;
        
        let cenas = 0, personagens = 0, dialogos = 0;
        for (let linha of editor.children) {
            if (linha.classList.contains('patika-cena')) cenas++;
            if (linha.classList.contains('patika-personagem')) personagens++;
            if (linha.classList.contains('patika-dialogo')) dialogos++;
        }
        
        alert(`üìä ESTAT√çSTICAS:
        
Palavras: ${palavras}
Caracteres: ${caracteres}
P√°ginas: ${Math.ceil(palavras/250)}
Cenas: ${cenas}
Personagens: ${personagens}
Di√°logos: ${dialogos}
Tempo: ${Math.ceil(palavras/150)} min`);
    };

    // ===== 6. ADICIONAR BOT√ïES NOVOS (SEM REMOVER EXISTENTES) =====
    setTimeout(() => {
        const toolbar = document.querySelector('.editor-toolbar');
        if (toolbar && !document.getElementById('btn-pdf')) {
            // Bot√£o PDF
            const btnPDF = document.createElement('button');
            btnPDF.id = 'btn-pdf';
            btnPDF.className = 'btn';
            btnPDF.innerHTML = 'üìÑ PDF';
            btnPDF.onclick = window.exportarPDF;
            toolbar.appendChild(btnPDF);
            
            // Bot√£o Estat√≠sticas
            const btnStats = document.createElement('button');
            btnStats.id = 'btn-stats';
            btnStats.className = 'btn';
            btnStats.innerHTML = 'üìä Stats';
            btnStats.onclick = window.estatisticasAvancadas;
            toolbar.appendChild(btnStats);
            
            console.log('‚úÖ Bot√µes adicionados com seguran√ßa');
        }
    }, 1000);

    // ===== 7. PREVENIR PERDA DE DADOS =====
    window.addEventListener('beforeunload', function(e) {
        const editor = document.getElementById('roteiro-editor');
        const lastSave = localStorage.getItem('patika_autosave');
        
        if (editor && lastSave && editor.innerHTML !== lastSave) {
            e.preventDefault();
            e.returnValue = 'H√° altera√ß√µes n√£o salvas. Deseja realmente sair?';
        }
    });

    // ===== 8. CLIQUE DUPLO NAS CENAS =====
    document.addEventListener('dblclick', function(e) {
        if (e.target.classList.contains('cena-item')) {
            e.target.style.backgroundColor = 'var(--accent-selection, #e8efe9)';
            setTimeout(() => {
                e.target.style.backgroundColor = '';
            }, 300);
        }
    });

    console.log('üöÄ Melhorias seguras do Patika carregadas!');
})();
</script>
<!-- ===== FIM DAS NOVAS FUNCIONALIDADES ===== -->


<!-- ===== PACOTE MOBILE PATIKA ===== -->
<style>
/* ===== MOBILE FIRST - ADAPTA√á√ïES ===== */

/* Esconder sidebars em mobile */
@media (max-width: 768px) {
    /* Layout em coluna √∫nica */
    .app {
        grid-template-columns: 1fr !important;
    }
    
    /* Esconder sidebars */
    .sidebar-left,
    .sidebar-right {
        display: none !important;
    }
    
    /* Ajustar √°rea principal */
    .main-content {
        margin: 10px !important;
        padding: 15px !important;
        width: auto !important;
    }
    
    /* Toolbar com scroll horizontal */
    .editor-toolbar {
        overflow-x: auto !important;
        white-space: nowrap !important;
        flex-wrap: nowrap !important;
        padding: 10px !important;
        margin: 10px 0 !important;
        -webkit-overflow-scrolling: touch !important;
    }
    
    .editor-toolbar .btn {
        display: inline-block !important;
        margin: 0 5px !important;
        white-space: nowrap !important;
    }
    
    /* Editor com tamanho adequado */
    .roteiro-editor {
        min-height: 400px !important;
        padding: 15px !important;
        font-size: 16px !important;
        line-height: 1.6 !important;
    }
    
    /* Ajustar formata√ß√£o do roteiro */
    .patika-personagem {
        margin-left: 100px !important;
    }
    
    .patika-dialogo {
        margin-left: 60px !important;
        margin-right: 20px !important;
    }
    
    /* Menu mobile */
    .mobile-menu-btn {
        display: block !important;
        position: fixed;
        top: 10px;
        left: 10px;
        z-index: 1000;
        width: 50px;
        height: 50px;
        border-radius: 8px;
        background: var(--accent-primary);
        color: white;
        border: none;
        font-size: 24px;
        cursor: pointer;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    
    .mobile-menu-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        z-index: 998;
    }
    
    .mobile-menu {
        position: fixed;
        top: 0;
        left: -280px;
        width: 280px;
        height: 100%;
        background: var(--bg-surface);
        z-index: 999;
        transition: left 0.3s ease;
        box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        overflow-y: auto;
        padding: 20px;
    }
    
    .mobile-menu.open {
        left: 0;
    }
    
    .mobile-menu .menu-section {
        margin-bottom: 20px;
    }
    
    .mobile-menu .menu-title {
        color: var(--accent-primary);
        font-weight: bold;
        margin-bottom: 10px;
        font-size: 14px;
    }
    
    .mobile-menu .menu-item {
        padding: 12px;
        margin: 5px 0;
        border-radius: 8px;
        cursor: pointer;
        background: var(--bg-sidebar);
    }
    
    /* Ajustar lista de cenas para mobile */
    #listaCenasSidebar {
        max-height: 200px !important;
        overflow-y: auto !important;
        margin-top: 10px !important;
    }
    
    .cena-item {
        padding: 12px !important;
        margin: 5px 0 !important;
        font-size: 14px !important;
    }
    
    /* Notifica√ß√µes mobile */
    .patika-tooltip {
        bottom: 20px !important;
        right: 20px !important;
        left: 20px !important;
        width: auto !important;
        max-width: none !important;
        text-align: center !important;
    }
    
    /* Bot√µes de a√ß√£o mobile */
    .nav-arrows {
        bottom: 15px !important;
        right: 15px !important;
    }
    
    .nav-arrow {
        width: 45px !important;
        height: 45px !important;
        font-size: 20px !important;
    }
    
    /* Ajustar cabe√ßalho */
    .top-bar {
        padding-left: 70px !important;
        min-height: 60px !important;
    }
    
    .project-status {
        font-size: 12px !important;
    }
    
    /* Indicadores de toque */
    .btn, .menu-item, .cena-item {
        min-height: 44px !important;
    }
    
    .btn:active, .menu-item:active, .cena-item:active {
        opacity: 0.7 !important;
    }
}

/* Tablets */
@media (min-width: 769px) and (max-width: 1024px) {
    .app {
        grid-template-columns: 200px 1fr 250px !important;
    }
    
    .patika-personagem {
        margin-left: 150px !important;
    }
    
    .patika-dialogo {
        margin-left: 100px !important;
        margin-right: 80px !important;
    }
}
</style>

<!-- ===== ELEMENTOS MOBILE ===== -->
<button class="mobile-menu-btn" id="mobileMenuBtn">‚ò∞</button>
<div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>
<div class="mobile-menu" id="mobileMenu"></div>

<script>
(function() {
    'use strict';

    // ===== DETECTAR MOBILE =====
    const isMobile = window.matchMedia('(max-width: 768px)').matches;
    
    // ===== MENU MOBILE =====
    const menuBtn = document.getElementById('mobileMenuBtn');
    const menuOverlay = document.getElementById('mobileMenuOverlay');
    const mobileMenu = document.getElementById('mobileMenu');
    
    if (menuBtn && menuOverlay && mobileMenu) {
        // Clonar menu lateral para o mobile
        const sidebarLeft = document.querySelector('.sidebar-left');
        if (sidebarLeft) {
            mobileMenu.innerHTML = sidebarLeft.innerHTML;
        }
        
        // Abrir menu
        menuBtn.addEventListener('click', () => {
            mobileMenu.classList.add('open');
            menuOverlay.style.display = 'block';
            document.body.style.overflow = 'hidden';
        });
        
        // Fechar menu
        menuOverlay.addEventListener('click', () => {
            mobileMenu.classList.remove('open');
            menuOverlay.style.display = 'none';
            document.body.style.overflow = '';
        });
        
        // Fechar ao clicar em item
        mobileMenu.addEventListener('click', (e) => {
            if (e.target.classList.contains('menu-item')) {
                setTimeout(() => {
                    mobileMenu.classList.remove('open');
                    menuOverlay.style.display = 'none';
                    document.body.style.overflow = '';
                }, 300);
            }
        });
    }
    
    // ===== SWIPE PARA NAVEGAR ENTRE ABAS =====
    let touchStartX = 0;
    let touchEndX = 0;
    
    document.addEventListener('touchstart', (e) => {
        touchStartX = e.changedTouches[0].screenX;
    }, { passive: true });
    
    document.addEventListener('touchend', (e) => {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
    }, { passive: true });
    
    function handleSwipe() {
        if (!isMobile) return;
        
        const swipeThreshold = 100;
        const diff = touchEndX - touchStartX;
        const tabs = document.querySelectorAll('.tab-item');
        
        if (Math.abs(diff) > swipeThreshold && tabs.length) {
            let currentIndex = 0;
            tabs.forEach((tab, index) => {
                if (tab.classList.contains('active')) {
                    currentIndex = index;
                }
            });
            
            if (diff > 0 && currentIndex > 0) {
                // Swipe direita ‚Üí aba anterior
                tabs[currentIndex - 1].click();
            } else if (diff < 0 && currentIndex < tabs.length - 1) {
                // Swipe esquerda ‚Üí pr√≥xima aba
                tabs[currentIndex + 1].click();
            }
        }
    }
    
    // ===== BOT√ïES DE NAVEGA√á√ÉO MOBILE =====
    const navPrev = document.getElementById('navPrev');
    const navNext = document.getElementById('navNext');
    
    if (navPrev && navNext) {
        navPrev.addEventListener('click', () => {
            const tabs = document.querySelectorAll('.tab-item');
            let currentIndex = 0;
            tabs.forEach((tab, index) => {
                if (tab.classList.contains('active')) {
                    currentIndex = index;
                }
            });
            if (currentIndex > 0) {
                tabs[currentIndex - 1].click();
            }
        });
        
        navNext.addEventListener('click', () => {
            const tabs = document.querySelectorAll('.tab-item');
            let currentIndex = 0;
            tabs.forEach((tab, index) => {
                if (tab.classList.contains('active')) {
                    currentIndex = index;
                }
            });
            if (currentIndex < tabs.length - 1) {
                tabs[currentIndex + 1].click();
            }
        });
    }
    
    // ===== AJUSTAR VIEWPORT PARA MOBILE =====
    function adjustViewport() {
        const viewport = document.querySelector('meta[name="viewport"]');
        if (!viewport) {
            const meta = document.createElement('meta');
            meta.name = 'viewport';
            meta.content = 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes';
            document.head.appendChild(meta);
        }
    }
    adjustViewport();
    
    // ===== DETECTAR ORIENTA√á√ÉO =====
    function handleOrientation() {
        if (window.matchMedia('(orientation: portrait)').matches) {
            document.body.setAttribute('data-orientation', 'portrait');
        } else {
            document.body.setAttribute('data-orientation', 'landscape');
        }
    }
    
    window.addEventListener('orientationchange', handleOrientation);
    handleOrientation();
    
    console.log('üì± Modo mobile ativado!');
})();
</script>
<!-- ===== FIM DO PACOTE MOBILE ===== -->

