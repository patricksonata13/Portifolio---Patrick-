<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PATIKA ‚Ä¢ Editor de Roteiro</title>
    <link rel="stylesheet" href="../assets/css/patika-editor.css">
    <link rel="stylesheet" href="../assets/icons/patika-icons.css">
    <!-- TEMA FINAL DRAFT - APENAS CORES -->
    <link rel="stylesheet" href="../assets/css/finaldraft-theme.css">
    <style>
        body { margin: 0; padding: 0; font-family: 'Courier New', monospace; }
        
        .editor-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--fd-paper);
            border-bottom: 1px solid var(--fd-border);
            padding: 15px 30px;
            display: flex;
            align-items: center;
            gap: 20px;
            z-index: 900;
        }
        
        .editor-header button {
            background: transparent;
            border: 1px solid var(--fd-border);
            padding: 8px 16px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .editor-header button:hover {
            background: var(--fd-text);
            color: var(--fd-paper);
        }
        
        .editor-content {
            margin-top: 80px;
        }
        
        .editor-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--fd-paper);
            border-top: 1px solid var(--fd-border);
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 900;
            color: var(--fd-meta);
        }
        
        .editor-footer span {
            display: flex;
            align-items: center;
            gap: 5px;
        }
    </style>
</head>
<body class="finaldraft-mode">
    <!-- CABE√áALHO -->
    <div class="editor-header">
        <span class="icon icon-cmd icon-lg" style="color: #6c9a8f;"></span>
        <span style="flex:1;"></span>
        <button onclick="window.location.href='../src/pages/patika/'">
            <span class="icon icon-back"></span> VOLTAR
        </button>
        <button onclick="exportarPDF()">
            <span class="icon icon-enter"></span> EXPORTAR
        </button>
        <button onclick="salvarRoteiro()">
            <span class="icon icon-pencil"></span> SALVAR
        </button>
        <button onclick="toggleNightMode()">
            <span class="icon icon-sun"></span> MODO
        </button>
    </div>
    
    <!-- EDITOR PRINCIPAL -->
    <div class="editor-container">
        <div class="editor-content">
            <div class="editor-paper" id="scriptPaper" contenteditable="true">
                <!-- Conte√∫do inicial -->
                <div class="script-title">MEU ROTEIRO</div>
                
                <div class="script-scene">INT. ESCRIT√ìRIO DE PATRICK - DIA</div>
                
                <div class="script-action">Patrick est√° diante do computador, finalmente com sua ferramenta de roteiro ideal.</div>
                
                <div class="script-char">PATRICK</div>
                <div class="script-dialog">Finalmente! Um editor com estilo Final Draft, mas com a alma do PATIKA.</div>
                
                <div class="script-action">Ele testa o modo noturno e os √≠cones minimalistas.</div>
                
                <div class="script-char">PATRICK (V.O.)</div>
                <div class="script-dialog">Cores neutras, √≠cones de terminal, formata√ß√£o profissional... perfeito.</div>
                
                <div class="script-transition">CORTE PARA:</div>
            </div>
        </div>
    </div>
    
    <!-- RODAP√â -->
    <div class="editor-footer">
        <span><span class="icon icon-circle icon-xs"></span> <span id="contadorPalavras">1.234</span> palavras</span>
        <span><span class="icon icon-cmd icon-xs"></span> PATIKA v8.0</span>
        <span><span class="icon icon-dot icon-xs"></span> <span id="statusSalvo">Salvo</span></span>
    </div>
    
    <script>
        // ========================================
        // FUN√á√ïES DO PATIKA - TODAS PRESERVADAS
        // ========================================
        
        // Pegar o modo da URL
        const urlParams = new URLSearchParams(window.location.search);
        const modo = urlParams.get('modo');
        
        if (modo) {
            console.log(`‚úÖ Modo ${modo} selecionado`);
            localStorage.setItem('patika_modo', modo);
            
            // Mostrar notifica√ß√£o
            const notif = document.createElement('div');
            notif.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #6c9a8f;
                color: #000;
                padding: 15px 30px;
                border-radius: 5px;
                font-family: 'Courier New', monospace;
                z-index: 9999;
                animation: slideIn 0.3s;
            `;
            notif.textContent = `‚úÖ Modo ${modo} ativado`;
            document.body.appendChild(notif);
            setTimeout(() => notif.remove(), 3000);
        }
        
        // Carregar roteiro salvo
        document.addEventListener('DOMContentLoaded', () => {
            const salvo = localStorage.getItem('patika_roteiro_atual');
            if (salvo) {
                document.getElementById('scriptPaper').innerHTML = salvo;
            }
            atualizarContador();
        });
        
        // Auto-save
        let timeoutAutoSave;
        document.getElementById('scriptPaper').addEventListener('input', () => {
            clearTimeout(timeoutAutoSave);
            document.getElementById('statusSalvo').innerHTML = 'Editando...';
            
            timeoutAutoSave = setTimeout(() => {
                salvarRoteiro();
            }, 2000);
            
            atualizarContador();
        });
        
        function salvarRoteiro() {
            const conteudo = document.getElementById('scriptPaper').innerHTML;
            localStorage.setItem('patika_roteiro_atual', conteudo);
            document.getElementById('statusSalvo').innerHTML = 'Salvo';
            console.log('üíæ Roteiro salvo');
        }
        
        function atualizarContador() {
            const texto = document.getElementById('scriptPaper').innerText;
            const palavras = texto.trim().split(/\s+/).length;
            document.getElementById('contadorPalavras').innerHTML = palavras;
        }
        
        // Salvar antes de sair
        window.addEventListener('beforeunload', () => {
            const conteudo = document.getElementById('scriptPaper').innerHTML;
            localStorage.setItem('patika_roteiro_atual', conteudo);
        });
        
        // Exportar PDF (placeholder)
        function exportarPDF() {
            alert('üìÑ Exportando PDF... (funcionalidade completa em breve)');
        }
        
        // Modo noturno (opcional)
        function toggleNightMode() {
            document.body.classList.toggle('night-mode');
            localStorage.setItem('patika_night_mode', document.body.classList.contains('night-mode'));
        }
        
        // Carregar prefer√™ncia do modo noturno
        if (localStorage.getItem('patika_night_mode') === 'true') {
            document.body.classList.add('night-mode');
        }
        
        // Auto-save a cada 30 segundos
        setInterval(() => {
            if (document.getElementById('statusSalvo').innerHTML !== 'Salvo') {
                salvarRoteiro();
            }
        }, 30000);
        
        // Anima√ß√µes
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
