<!DOCTYPE html>
<html>
<head>
    <title>CDD 3001 ‚Ä¢ MISS√ïES DI√ÅRIAS</title>
    <link rel="stylesheet" href="/cdd/assets/css/global.css">
    <style>
        .daily-missions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .mission-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            padding: 20px;
            position: relative;
        }
        .mission-card.completed {
            border-color: var(--success);
            opacity: 0.7;
        }
        .mission-title {
            color: var(--accent-primary);
            font-size: 1.2rem;
            margin-bottom: 10px;
        }
        .mission-reward {
            background: var(--bg-secondary);
            padding: 10px;
            margin: 15px 0;
            color: var(--accent-secondary);
        }
        .progress-bar {
            height: 4px;
            background: var(--bg-primary);
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: var(--accent-primary);
            transition: width 0.3s;
        }
        .mission-status {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 20px;
        }
        .reset-timer {
            text-align: center;
            color: var(--accent-secondary);
            font-size: 14px;
            margin: 20px;
        }
    </style>
</head>
<body>
    <div class="terminal">
        <div class="terminal-header">
            <span>CDD-3001/MISS√ïES</span>
            <span>üìÖ MISS√ïES DI√ÅRIAS</span>
        </div>

        <h1>üìÖ MISS√ïES DA RESIST√äNCIA</h1>

        <div class="reset-timer" id="reset-timer">
            ‚è≥ Reset em: <span id="countdown">carregando...</span>
        </div>

        <div class="daily-missions" id="missions-container">
            Carregando miss√µes...
        </div>

        <div style="text-align: center; margin: 20px;">
            <a href="/cdd/" class="btn">‚Üê VOLTAR</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const SUPABASE_URL = 'https://uhchpjdkuogdspkzujua.supabase.co'
        const SUPABASE_ANON_KEY = 'sb_publishable_7jGY1vUGLgdvoSqy6I9e6g_zl-Wn1Vn'
        const supabase = supabaseClient.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

        const missoesDiarias = [
            {
                id: 1,
                titulo: 'üíÄ CA√áADOR DE BRANQUELOS',
                descricao: 'Derrote 5 Branquelos',
                progresso: 0,
                total: 5,
                xp: 100,
                item: 'fragmento_osso'
            },
            {
                id: 2,
                titulo: 'üìñ ARQUIVISTA',
                descricao: 'Colete 3 mem√≥rias',
                progresso: 0,
                total: 3,
                xp: 150,
                item: 'diario_pagina'
            },
            {
                id: 3,
                titulo: 'üó∫Ô∏è EXPLORADOR',
                descricao: 'Visite 4 locais diferentes',
                progresso: 0,
                total: 4,
                xp: 75,
                item: 'mapa_fragmento'
            },
            {
                id: 4,
                titulo: 'üî® ARTES√ÉO',
                descricao: 'Crafte 2 itens',
                progresso: 0,
                total: 2,
                xp: 200,
                item: 'ferramentas'
            },
            {
                id: 5,
                titulo: 'ü§ù ALIADOS',
                descricao: 'Converse com 3 aliados',
                progresso: 0,
                total: 3,
                xp: 125,
                item: 'racao'
            }
        ]

        function carregarMissoes() {
            const container = document.getElementById('missions-container')
            
            container.innerHTML = missoesDiarias.map(m => {
                const percent = (m.progresso / m.total) * 100
                const completa = m.progresso >= m.total
                
                return `
                    <div class="mission-card ${completa ? 'completed' : ''}">
                        <div class="mission-status">${completa ? '‚úÖ' : '‚è≥'}</div>
                        <div class="mission-title">${m.titulo}</div>
                        <div class="mission-reward">
                            +${m.xp} XP ‚Ä¢ üéí ${m.item}
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>Progresso: ${m.progresso}/${m.total}</span>
                            <span>${Math.round(percent)}%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${percent}%;"></div>
                        </div>
                        ${!completa ? `
                            <button class="btn" style="width: 100%; margin-top: 10px;" 
                                    onclick="registrarProgresso(${m.id})">
                                REGISTRAR PROGRESSO
                            </button>
                        ` : ''}
                    </div>
                `
            }).join('')
        }

        function registrarProgresso(id) {
            const missao = missoesDiarias.find(m => m.id === id)
            if (missao.progresso < missao.total) {
                missao.progresso++
                
                if (missao.progresso === missao.total) {
                    // Completou a miss√£o
                    if (window.rpg) {
                        window.rpg.ganharXP(missao.xp, `miss√£o di√°ria: ${missao.titulo}`)
                        window.rpg.coletarItem(missao.item, 1)
                    }
                }
                
                carregarMissoes()
            }
        }

        // TIMER DE RESET (24h)
        function updateTimer() {
            const now = new Date()
            const reset = new Date()
            reset.setHours(24, 0, 0, 0) // Reset √† meia-noite
            
            const diff = reset - now
            const hours = Math.floor(diff / 3600000)
            const minutes = Math.floor((diff % 3600000) / 60000)
            const seconds = Math.floor((diff % 60000) / 1000)
            
            document.getElementById('countdown').textContent = 
                `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`
        }

        carregarMissoes()
        setInterval(updateTimer, 1000)
        updateTimer()

        // Resetar miss√µes √† meia-noite
        setInterval(() => {
            const now = new Date()
            if (now.getHours() === 0 && now.getMinutes() === 0) {
                missoesDiarias.forEach(m => m.progresso = 0)
                carregarMissoes()
            }
        }, 60000)
    </script>
</body>
</html>
